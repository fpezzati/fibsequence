anguage: node_js
node_js:
 - "node"
sudo: required
services:
  - docker

before-install:
  - docker build -t fpezzati/fibworker_test -f ./fibworker/Dockerfile.dev ./fibworker
  - docker build -t fpezzati/fibserver_test -f -/server/Dockerfile.dev ./server
  - docker build -t fpezzati/fibclient_test -f ./client/Dockerfile.dev ./client

scripts:
  - docker run fpezzati/fibworker_test npm run test -- --coverage
  - docker run fpezzati/fibserver_test npm run test -- --coverage
  - docker run fpezzati/fibclient_test npm run test -- --coverage

after_success:
  - docker build -t fpezzati/fibsequence_fibworker ./fibworker -f ./fibworker/Dockerfile.prod
  - docker build -t fpezzati/fibsequence_client ./client -f ./client/Dockerfile.prod
  - docker build -t fpezzati/fibserver ./server -f ./server/Dockerfile.prod
  - docker build -t fpezzati/fibnginx ./nginx -f ./nginx/Dockerfile.prod
